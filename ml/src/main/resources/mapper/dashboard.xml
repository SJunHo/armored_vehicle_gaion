<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.gaion.armoredVehicle.web.analysis.mapper.DashboardMapper">

	<select id="findDashboardInfo" parameterType="java.util.HashMap" resultType="kr.co.gaion.scas.monitoring.model.Dashboard">
		select (select IFNULL(count(distinct s.sdaid),0)
		from STATSDA s
		where s.operdate like '${operdate}%'
		<choose>
			<when test="sdaidList.size != 0">
				and	s.sdaid in
				<foreach collection="sdaidList" item="item" index="index" separator="," open="(" close=")">
					#{item.sdaid}
				</foreach>
			</when>
		</choose>
		) as statsda,
		(select IFNULL(count(distinct d.sdaid),0)
		from DTCTSDA d
		where d.dttime like '${operdate}%'
		<choose>
			<when test="sdaidList.size != 0">
				and	d.sdaid in
				<foreach collection="sdaidList" item="item" index="index" separator="," open="(" close=")">
					#{item.sdaid}
				</foreach>
			</when>
		</choose>
		) as dtctsda,
		(select IFNULL(COUNT(DISTINCT b.sdaid),0)
		from BERDATA b , ENGDATA e , GRBDATA g , WHLDATA w
		where (b.`DATE` = e.`DATE` and b.`DATE` = g.`DATE` and b.`DATE` = w.`DATE`)
		and (AI_LBPFO, AI_LBPFI, AI_LBSF, AI_LFTF,
		AI_RBPFO, AI_RBPFI, AI_RBSF, AI_RFTF) in (('1','1','1','1','1','1','1','1'))
		and AI_ENGINE = '1' and AI_GEAR = '1'
		and (AI_LW, AI_RW) IN (('1','1'))
		<choose>
			<when test="sdaidList.size != 0">
				and	b.sdaid in
				<foreach collection="sdaidList" item="item" index="index" separator="," open="(" close=")">
					#{item.sdaid}
				</foreach>
			</when>
		</choose>
		and b.`DATE` like '${operdate}%') as bkdsda
		from dual
	</select>

	<select id="findAbnormalVehicle" parameterType="java.util.HashMap" resultType="String">
		(select distinct d.sdaid
		from DTCTSDA d
		where d.dttime like '${operdate}%'
		<choose>
			<when test="sdaidList.size != 0">
				and	d.sdaid in
				<foreach collection="sdaidList" item="item" index="index" separator="," open="(" close=")">
					#{item.sdaid}
				</foreach>
			</when>
		</choose>
		)
		union
		(select DISTINCT b.sdaid
		from BERDATA b , ENGDATA e , GRBDATA g , WHLDATA w
		where (b.`DATE` = e.`DATE` and b.`DATE` = g.`DATE` and b.`DATE` = w.`DATE`)
		and (AI_LBPFO, AI_LBPFI, AI_LBSF, AI_LFTF,
		AI_RBPFO, AI_RBPFI, AI_RBSF, AI_RFTF) in (('1','1','1','1','1','1','1','1'))
		and AI_ENGINE = '1' and AI_GEAR = '1'
		and (AI_LW, AI_RW) IN (('1','1'))
		and b.`DATE` like '${operdate}%'
		<choose>
			<when test="sdaidList.size != 0">
				and	b.sdaid in
				<foreach collection="sdaidList" item="item" index="index" separator="," open="(" close=")">
					#{item.sdaid}
				</foreach>
			</when>
		</choose>
		)
	</select>

</mapper>