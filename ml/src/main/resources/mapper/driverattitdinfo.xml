<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.gaion.armoredVehicle.web.analysis.mapper.DriverattitdinfoMapper">
	<insert id="insertDriverattitdinfo" parameterType="kr.gaion.armoredVehicle.web.analysis.model.DriverAttitdInfo">
		insert into DRIVERATTITDINFO(sdaid, daid, dttime, filenm, snsrvle)
		values(#{sdaid}, #{daid}, #{dttime}, #{filenm}, #{snsrvle})
	</insert>
	
	<select id="findDriverInfoBySearch" parameterType="kr.gaion.armoredVehicle.web.analysis.model.SearchRequest"
	 resultType="kr.gaion.armoredVehicle.web.analysis.model.DriverCorrectInfo">
		select s.DIVS as divs, concat(s.BRGD,s.BN) as bn, s.SDANM as sdanm, d2.dttime as dttime, s2.snsrnm as snsrnm ,d2.snsrvle as snsrvle ,d.STDVAL as stdval , d.msg as msg
		from DRIVERATTITDINFO d2
		left join DRIVERATTITD d on d2.daid = d.daid
		left join SDA s on d2.sdaid = s.SDAID
		left join SNSR s2 on s2.snsrid = d2.snsrid
		<![CDATA[where STR_TO_DATE(d2.dttime, '%Y-%m-%d') >= DATE_FORMAT(#{startDate}, '%Y-%m-%d')
							  and STR_TO_DATE(d2.dttime, '%Y-%m-%d')  <= DATE_FORMAT(#{endDate}, '%Y-%m-%d')]]>
		and s.sdaid = #{sdaid}
		and s.divscode = #{divscode}
		and s.brgdbncode = #{brgdbncode}
		group by d2.daid, d2.dttime
		order by dttime desc
		limit #{page}, #{size}
	 </select>
	 
	 <select id="countDriverInfoBySearch" parameterType="kr.gaion.armoredVehicle.web.analysis.model.SearchRequest"
	 	resultType="Integer">
		 select ifnull(count(distinct d2.dttime),0)
		 from DRIVERATTITDINFO d2
		 left join DRIVERATTITD d on d2.daid = d.daid
		 left join SDA s on d2.sdaid = s.SDAID
		 left join SNSR s2 on s2.snsrid = d2.snsrid
		 <![CDATA[where STR_TO_DATE(d2.dttime, '%Y-%m-%d') >= DATE_FORMAT(#{startDate}, '%Y-%m-%d')
								  and STR_TO_DATE(d2.dttime, '%Y-%m-%d')  <= DATE_FORMAT(#{endDate}, '%Y-%m-%d')]]>
		 and s.sdaid = #{sdaid}
		 and s.divscode = #{divscode}
		 and s.brgdbncode = #{brgdbncode}
	 </select>

	<select id="countDriverPopUpInfo" parameterType="kr.gaion.armoredVehicle.web.analysis.model.SearchRequest"
			resultType="Integer">
		select ifnull(count(*),0)
		from DRIVERATTITDINFO d2
		<![CDATA[where STR_TO_DATE(d2.dttime, '%Y-%m-%d') >= DATE_FORMAT(#{startDate}, '%Y-%m-%d')
								  and STR_TO_DATE(d2.dttime, '%Y-%m-%d')  <= DATE_FORMAT(#{endDate}, '%Y-%m-%d')]]>
		and d2.sdaid = #{sdaid}
	</select>
</mapper>