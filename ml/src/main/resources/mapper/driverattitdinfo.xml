<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.gaion.armoredVehicle.web.analysis.mapper.DriverattitdinfoMapper">
	<insert id="insertDriverattitdinfo" parameterType="kr.gaion.armoredVehicle.web.analysis.model.DriverAttitdInfo">
		insert into DRIVERATTITDINFO(sdaid, daid, dttime, filenm, snsrvle)
		values(#{sdaid}, #{daid}, #{dttime}, #{filenm}, #{snsrvle})
	</insert>
	
	<select id="findDriverInfoBySearch" parameterType="kr.gaion.armoredVehicle.web.analysis.model.SearchRequest"
	 resultType="kr.gaion.armoredVehicle.web.analysis.model.DriverCorrectInfo">
	 	select s.DIVS as divs, concat(s.BRGD,s.BN) as bn, s.SDANM as sdanm, d2.dttime as dttime, s2.snsrnm as snsrnm ,d2.snsrvle as snsrvle ,d.STDVAL as stdval , d.msg as msg 
		from DRIVERATTITD d ,DRIVERATTITDINFO d2 , SDA s ,SNSR s2 
		where d2.daid = d.daid and s.SDAID = d2.sdaid and d.snsrid = s2.snsrid 
		and (d.snsrid = 'ACCPEDAL' or d.snsrid = 'SDHSPD' or d.snsrid = 'VOLTAGE' or d.snsrid ='ENGHEAT')
		<![CDATA[and STR_TO_DATE(d2.dttime, '%Y-%m-%d') >= DATE_FORMAT(#{startDate}, '%Y-%m-%d') 
							  and STR_TO_DATE(d2.dttime, '%Y-%m-%d')  <= DATE_FORMAT(#{endDate}, '%Y-%m-%d')]]>
		and s.sdaid = #{sdaid}
		and s.divscode = #{divscode}
		and s.brgdbncode = #{brgdbncode}
		limit #{page}, #{size}
	 </select>
	 
	 <select id="countDriverInfoBySearch" parameterType="kr.gaion.armoredVehicle.web.analysis.model.SearchRequest"
	 	resultType="Integer">
		 	select ifnull(count(d2.dttime),0)
			from DRIVERATTITD d ,DRIVERATTITDINFO d2 , SDA s ,SNSR s2 
			where d2.daid = d.daid and s.SDAID = d2.sdaid and d.snsrid = s2.snsrid 
			and (d.snsrid = 'ACCPEDAL' or d.snsrid = 'SDHSPD' or d.snsrid = 'VOLTAGE' or d.snsrid ='ENGHEAT')
			<![CDATA[and STR_TO_DATE(d2.dttime, '%Y-%m-%d') >= DATE_FORMAT(#{startDate}, '%Y-%m-%d') 
								  and STR_TO_DATE(d2.dttime, '%Y-%m-%d')  <= DATE_FORMAT(#{endDate}, '%Y-%m-%d')]]>
			and s.sdaid = #{sdaid}
			and s.divscode = #{divscode}
			and s.brgdbncode = #{brgdbncode}
	 	</select>
</mapper>