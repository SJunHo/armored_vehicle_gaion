<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.gaion.armoredVehicle.web.analysis.mapper.StatsdaMapper">

	<select id="findStatsdaByListSdaid" parameterType="java.util.HashMap" resultType="kr.gaion.armoredVehicle.web.analysis.model.Statsda">
		select  sdaid , avg(avgspd) as avgspd , avg(engnnldnrate) as engnnldnrate,
				 avg(mvmtdstc) as mvmtdstc, avg(mvmttime) as mvmttime
		from STATSDA
		where
			1=1
		and operdate like CONCAT('%',#{operdate},'%')
		 <choose>
		 	<when test="sdaidList.size != 0">
			and	sdaid in 
				<foreach collection="sdaidList" item="item" index="index" separator="," open="(" close=")">
					#{item}
				</foreach>
		 	</when>		 
		 </choose>
		group by sdaid
	</select>
	
	<select id="findStatsdaByGroupDivs" parameterType="String" resultType="kr.gaion.armoredVehicle.web.analysis.model.StatsdaGroup">
		select SDA.DIVS as groupName, avg(avgspd) as avgspd , avg(engnnldnrate) as engnnldnrate,
		avg(mvmtdstc) as mvmtdstc, avg(mvmttime) as mvmttime
		from SDA, STATSDA
		where SDA.sdaid = STATSDA.sdaid 
		and operdate like CONCAT('%',#{operdate},'%')
		group by SDA.DIVS
	</select>
	
	<select id="findStatsdaByGroupBN" parameterType="String" resultType = "kr.gaion.armoredVehicle.web.analysis.model.StatsdaGroup">
		select SDA.BN as groupName, avg(avgspd) as avgspd , avg(engnnldnrate) as engnnldnrate,
		avg(mvmtdstc) as mvmtdstc, avg(mvmttime) as mvmttime
		from SDA, STATSDA
		where SDA.sdaid = STATSDA.sdaid
		and operdate like CONCAT('%',#{operdate},'%')
		and SDA.DIVSCODE = #{divscode}
		group by SDA.BN;
	</select>

	<select id="countStatssdaAll" resultType="Integer">
		select count(distinct sdaid)
		from STATSDA
		where operdate like CONCAT('%',#{operdate},'%')
	</select>
	
	<select id="countStatssda" parameterType="java.util.Map" resultType="Integer">
		select count(distinct sdaid)
		from STATSDA
		where sdaid = #{sdaid}
		and operdate like CONCAT('%',#{operdate},'%')
	</select>
	
	<insert id="insertStatsda" parameterType="kr.gaion.armoredVehicle.web.analysis.model.Statsda">
		insert into STATSDA (filenm, avgspd, engnnldnrate, mvmtdstc, mvmttime, operdate, sdaid)
		values(#{filenm}, #{avgspd}, #{engnnldnrate}, #{mvmtdstc}, #{mvmttime}, #{operdate}, #{sdaid})
	</insert>
</mapper>